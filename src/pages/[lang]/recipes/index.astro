---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import RecipeCard from "../../../components/RecipeCard";
import { useTranslations } from "@/utils/i18n.ts";
import { getRelativeLocaleUrl } from "astro:i18n";
import { LOCALES } from "@/consts.ts";
import { getLocalizedContent } from "@/utils/content.ts";
import FallbackBanner from "@/components/FallbackBanner.astro";
import type { RecipesRecipes } from "../../../tina/__generated__/types";

export function getStaticPaths() {
  return LOCALES.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params;
const t = useTranslations(lang);

const { entry, isFallback } = await getLocalizedContent("recipes", lang);
const recipesData = entry?.data.recipes || [];
const recipes = recipesData.map((recipe: RecipesRecipes) => ({
  id: `${lang}/${recipe.id}`,
  data: {
    title: recipe.title,
    description: recipe.description,
    heroImage: recipe.heroImage,
  },
}));
---

<BaseLayout
  lang={lang}
  title={`${t.recipes_index.title} | Digital Independence Day`}
  description={t.recipes_index.desc}
>
  <div class="container mx-auto px-4 py-12">
    {isFallback && <FallbackBanner lang={lang} />}
    <header class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-display font-bold mb-4">
        {t.recipes_index.title}
      </h1>
      <p class="text-xl text-gray-600 dark:text-gray-400 max-w-2xl mx-auto">
        {t.recipes_index.desc}
      </p>
    </header>

    <div
      class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
      transition:animate="fade"
    >
      {
        recipes.map((recipe: { id: string; data: RecipesRecipes }) => (
          <RecipeCard
            recipe={recipe}
            href={getRelativeLocaleUrl(
              lang,
              `recipes/${recipe.id.split("/")[1]}`,
            )}
            client:load
          />
        ))
      }
    </div>
  </div>
</BaseLayout>
